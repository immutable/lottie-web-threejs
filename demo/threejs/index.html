<!DOCTYPE html>
<html style="width: 100%;height: 100%">
<head>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.151.3/three.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/three-orbit-controls@82.1.0/index.min.js"></script>
     <script type="importmap">
       {
         "imports": {
           "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.151.3/three.js",
           "three/addons/": "https://cdn.jsdelivr.net/npm/three-orbit-controls@82.1.0/index.min.js",
         }
       }
     </script>

     <script src="../../build/player/lottie.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.18"></script>
</head>
<body style="background-color:#ccc; margin: 0px;height: 100%; font-family: sans-serif;font-size: 10px">

<div style="width:100%;height:100%;background-color:#333;" id="bodymovin"></div>

<script>
     var GUI = lil.GUI;
     const gui = new GUI();
     const myObject = {
          myBoolean: true,
          myString: 'lil-gui',
          myNumber: 1,
          fov: 25,
          focus: 10,
          near: 10,
          far: 10000,
          ortho: false,
          cameraX: 972,
          cameraY: 477,
          cameraZ: 2536,
          lookX: 977,
          lookY: 540,
          lookZ: 0,
          cameraRotX: 0.0,
          cameraRotY: 0.0,
          cameraRotZ: 0.0,
     };

     gui.add( myObject, 'myBoolean' );  // Checkbox
     gui.add( myObject, 'myString' );   // Text Field
     gui.add( myObject, 'myNumber' );   // Number Field
     gui.add( myObject, 'fov' );   // Number Field
     gui.add( myObject, 'focus' );   // Number Field
     gui.add( myObject, 'near' );   // Number Field
     gui.add( myObject, 'far' );   // Number Field
     gui.add( myObject, 'ortho' );   // Number Field
     gui.add( myObject, 'cameraX' );   // Number Field
     gui.add( myObject, 'cameraY' );   // Number Field
     gui.add( myObject, 'cameraZ' );   // Number Field
     gui.add( myObject, 'lookX' );   // Number Field
     gui.add( myObject, 'lookY' );   // Number Field
     gui.add( myObject, 'lookZ' );   // Number Field
     gui.add( myObject, 'cameraRotX', -360.0, 360.0 );   // Number Field
     gui.add( myObject, 'cameraRotY', -360.0, 360.0 );   // Number Field
     gui.add( myObject, 'cameraRotZ', -360.0, 360.0 );   // Number Field


     var animData = {
        wrapper: document.getElementById('bodymovin'),
        animType: 'three',
        loop: true,
        prerender: true,
        autoplay: true,
        path: 'data.json',
        assetsPath: 'images/',
        rendererSettings: {
             preserveAspectRatio: 'xMidYMid meet',
        }
    };
    var anim = bodymovin.loadAnimation(animData);
    anim.play();
    anim.onError = (error) => {
         console.error(error);
    };
     var cameraElement;
    var camera;
    var currentLayerNum = -1;
    var currentPos = [960, 540, -2666.667];
    var mousePos = [960, 540, -2666.667];

    // function moveCamera(){
    //
    //
    //      // Pos z
    //      // camera.ks.p.k[0].s[2] = (currentPos[0] * -1) - 1000;
    //      // camera.ks.p.k[1].s[2] = (currentPos[0] * -1) - 1000;
    //
    //      // console.log('currentPos', currentPos[0]);
    //      // myObject.cameraX = currentPos[0]; // - windowW;
    //      // myObject.cameraY = currentPos[1]; // - windowH;
    //      // myObject.cameraZ = currentPos[2];
    //
    //      // console.log('Checking camera', cameraElement.globalData.three.camera.fov, myObject.fov);
    //      // if (cameraElement.globalData.three.camera.fov !== myObject.fov ||
    //      //         cameraElement.globalData.three.camera.focus !== myObject.focus) {
    //      //      cameraElement.globalData.three.camera.fov = myObject.fov;
    //      //      cameraElement.globalData.three.camera.focus = myObject.focus;
    //      //      cameraElement.globalData.three.camera.updateProjectionMatrix();
    //      //      // console.log('Updating the camera details', cameraElement.globalData.three.camera);
    //      // }
    //
    //      // cameraElement.globalData.three.camera.position.set(myObject.cameraX, myObject.cameraY, myObject.cameraZ);
    //      // cameraElement.globalData.three.look(myObject.lookX, myObject.lookY, myObject.lookZ);
    //      requestAnimationFrame(moveCamera);
    // }

    var windowW, windowH, dist;
    var mouseCoords = {
         x:0,
         y:0
    }
    function calculateSize(){
         windowW = window.innerWidth;
         windowH = window.innerHeight;
    }

    calculateSize();

    anim.addEventListener('DOMLoaded', function() {
         camera = anim.animationData.layers.find((layer) => layer.nm === 'Camera 1');
    });

    window.addEventListener('mousemove', function(ev){

         mouseCoords.x = (ev.clientX || ev.pageX);
         mouseCoords.y = ev.clientY || ev.pageY;
         theta = Math.atan2(
                 windowH/2 - mouseCoords.y,
                 windowW/2 - mouseCoords.x
         );

         dist = 2 * Math.sqrt(Math.pow(mouseCoords.x - windowW/2, 2) + Math.pow(mouseCoords.y - windowH/2, 2));
         dist = dist / 100;

         mousePos[0] = 960 + Math.cos(theta) * (dist * -1);
         mousePos[1] = 540 + Math.sin(theta )* (dist);

         currentPos[0] = currentPos[0] + (mousePos[0] - currentPos[0])*0.25;
         currentPos[1] = currentPos[1] + (mousePos[1] - currentPos[1])*0.25 + 10;
         currentPos[2] = currentPos[2] + (mousePos[2] - currentPos[2])*0.25;

         // Pos x
         camera.ks.p.k[0].s[0] = currentPos[0];
         camera.ks.p.k[1].s[0] = currentPos[0];

         // Pos y
         camera.ks.p.k[0].s[1] = currentPos[1];
         camera.ks.p.k[1].s[1] = currentPos[1];
    });

</script>
</body>
</html>
